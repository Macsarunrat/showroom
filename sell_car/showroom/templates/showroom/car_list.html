{% extends 'showroom/base.html' %} 

{% block content %}
<div class="mb-6 text-center">
  <h1 class="text-2xl font-bold text-gray-800">‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà üÜï</h1>

  <form method="GET" class="mb-6">
    <div class="flex gap-2">
      <input 
        type="text" 
        name="q" 
        placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏¢‡∏µ‡πà‡∏´‡πâ‡∏≠ ‡∏£‡∏∏‡πà‡∏ô..." 
        value="{{ request.GET.q|default:'' }}" 
        class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:border-blue-500"
      />

      <select 
        name="gear" 
        onchange="this.form.submit()" 
        class="px-4 py-2 rounded-lg border border-gray-300 bg-white text-gray-700"
      >
        <option value="">‡∏ó‡∏∏‡∏Å‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡πå</option>
        <option value="AUTO" {% if request.GET.gear == 'AUTO' %}selected{% endif %}>‡∏≠‡∏≠‡πÇ‡∏ï‡πâ</option>
        <option value="MANUAL" {% if request.GET.gear == 'MANUAL' %}selected{% endif %}>‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤</option>
      </select>

      <button 
        type="submit" 
        class="bg-blue-900 text-white px-4 py-2 rounded-lg hover:bg-blue-800"
      >
        üîç
      </button>
    </div>

    {% if request.GET.q or request.GET.gear %}
    <div class="mt-2 text-center">
      <a href="{% url 'car_list' %}" class="text-sm text-red-500 underline">‚ùå ‡∏•‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</a>
    </div>
    {% endif %}
  </form>

  <p class="text-gray-500 text-sm">‡∏Ñ‡∏±‡∏î‡πÄ‡∏ô‡πâ‡∏ô‡πÜ ‡∏£‡∏ñ‡∏ö‡πâ‡∏≤‡∏ô‡∏™‡∏†‡∏≤‡∏û‡∏ô‡∏≤‡∏á‡∏ü‡πâ‡∏≤</p>
</div>

<div class="grid grid-cols-1 gap-6 mb-12">
  {% for car in available_cars %}
  <div class="bg-white rounded-xl shadow-md overflow-hidden hover:shadow-lg transition duration-300 relative">
    
    <div class="relative aspect-[4/3] bg-gray-200">
      {% if car.images.first %}
      <img 
        src="{{ car.images.first.image.url }}" 
        alt="{{ car.model_name }}" 
        class="w-full h-full object-cover object-center" 
        loading="lazy"
      />
      {% else %}
      <div class="flex items-center justify-center h-full text-gray-400">
        ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û
      </div>
      {% endif %}

      <div class="absolute top-2 right-2 px-2 py-1 rounded text-xs font-bold 
        {% if car.status == 'AVAILABLE' %} bg-green-500 text-white 
        {% elif car.status == 'RESERVED' %} bg-yellow-400 text-black 
        {% else %} bg-red-500 text-white {% endif %}">
        {{ car.get_status_display }}
      </div>

    </div>

    <div class="p-4">
  <h2 class="font-bold text-lg text-gray-900 leading-tight">
    {{ car.brand }} {{ car.model_name }}
  </h2>
  
  <div class="flex items-center gap-1 mt-1">
    <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 text-green-500" viewBox="0 0 20 20" fill="currentColor">
      <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
    </svg>
    <span class="text-xs text-green-600 font-medium">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏†‡∏≤‡∏û‡πÇ‡∏î‡∏¢‡∏ä‡πà‡∏≤‡∏á‡πÅ‡∏•‡πâ‡∏ß</span>
  </div>
  <p class="text-gray-500 text-sm mt-1">
    ‡∏õ‡∏µ {{ car.year }} ‚Ä¢ {{ car.get_gear_display }}
  </p>

  <div class="mt-4 flex justify-between items-center">
    <div>
      <span class="text-red-600 font-bold text-xl block">{{ car.price|floatformat:0 }}.-</span>
      
      {% if car.installment %}
      <span class="text-xs text-gray-400">‡∏ú‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô {{ car.installment|floatformat:0 }}/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</span>
      {% endif %}
    </div>

    <a 
      href="{% url 'car_detail' car.pk %}" 
      class="bg-blue-900 text-white text-sm px-4 py-2 rounded-lg hover:bg-blue-800"
    >
      ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
    </a>
  </div>
</div>
  </div>
  {% empty %}
    {% if not sold_cars %}
    <p class="text-center text-gray-500 py-10">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏ñ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</p>
    {% endif %}
  {% endfor %}
</div>

{% if sold_cars %}
<div class="border-t-2 border-dashed border-gray-300 pt-8 relative pb-8">
    <div class="absolute -top-4 left-1/2 transform -translate-x-1/2 bg-gray-50 px-4 text-gray-400 text-sm font-bold">
        ‡∏Ç‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß [sold]
    </div>

    <div class="grid grid-cols-2 gap-4 opacity-75 grayscale hover:grayscale-0 hover:opacity-100 transition duration-500">
        {% for car in sold_cars %}
        <div class="bg-white rounded-lg shadow-sm overflow-hidden border border-gray-200 relative">
            <div class="relative aspect-[4/3] bg-gray-200">
                {% if car.images.first %}
                <img src="{{ car.images.first.image.url }}" loading="lazy" class="w-full h-full object-cover">
                {% endif %}
                
                <div class="absolute inset-0 flex items-center justify-center bg-black/30">
                    <span class="border-2 border-white text-white px-3 py-1 font-bold text-sm tracking-widest transform -rotate-12">
                        SOLD
                    </span>
                </div>
            </div>
            
            <div class="p-2">
                <h3 class="text-xs font-bold text-gray-600 truncate">{{ car.brand }} {{ car.model_name }}</h3>
                <p class="text-[10px] text-gray-400">‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢</p>
            </div>
            
            <a href="{% url 'car_detail' car.pk %}" class="absolute inset-0 z-10"></a>
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}

{% endblock %}